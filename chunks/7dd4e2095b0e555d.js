(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"warnOnce",{enumerable:!0,get:function(){return a}});let a=e=>{}},31700,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(18566),i=e.i(20755),r=e.i(42027),l=e.i(72776),d=e.i(56691);function n(){let e=(0,a.useRouter)(),[n,c]=(0,s.useState)([]),[o,u]=(0,s.useState)([]),[p,x]=(0,s.useState)(!0),[f,m]=(0,s.useState)(null),[h,g]=(0,s.useState)("all");(0,s.useEffect)(()=>{(async()=>{let t=(0,i.createClient)(),{data:{user:s}}=await t.auth.getUser();if(!s)return e.push("/auth/login");m(s);let{data:a,error:r}=await t.from("cards").select("*").or(`recipient_user_id.eq.${s.id},recipient_email.eq.${s.email}`).order("created_at",{ascending:!1});if(r)console.error("Failed to load received cards:",r),c([]);else{let e=(a||[]).filter(e=>e.recipient_user_id===s.id||e.recipient_email===s.email),t=new Date;t.setHours(0,0,0,0);let r=e.map(async e=>{if("date"===e.validity_type&&e.validity_date&&"used"!==e.status&&"cancelled"!==e.status&&"expired"!==e.status){let s=new Date(e.validity_date);if(s.setHours(0,0,0,0),s<t){let t=(0,i.createClient)();return await t.from("cards").update({status:"expired"}).eq("id",e.id),{...e,status:"expired"}}}return e});c(e=await Promise.all(r))}x(!1)})()},[e]),(0,s.useEffect)(()=>{let e=async()=>{if(!f)return;let e=(0,i.createClient)(),{data:{user:t}}=await e.auth.getUser();if(t){let{data:s,error:a}=await e.from("cards").select("*").or(`recipient_user_id.eq.${t.id},recipient_email.eq.${t.email}`).order("created_at",{ascending:!1});!a&&s&&c(s.filter(e=>e.recipient_user_id===t.id||e.recipient_email===t.email))}},t=()=>{!document.hidden&&f&&e()},s=()=>{f&&e()};return document.addEventListener("visibilitychange",t),window.addEventListener("focus",s),()=>{document.removeEventListener("visibilitychange",t),window.removeEventListener("focus",s)}},[f]),(0,s.useEffect)(()=>{let e=n;"pending"===h?e=n.filter(e=>"pending"===e.status||!e.status):"accepted"===h?e=n.filter(e=>"accepted"===e.status):"used"===h&&(e=n.filter(e=>"used"===e.status)),u(e)},[h,n]);let b=async e=>{if(!f)return;let t=(0,i.createClient)(),{error:s}=await t.from("cards").update({status:"accepted",recipient_user_id:f.id}).eq("id",e);s?console.error("Failed to accept card:",s):c(n.map(t=>t.id===e?{...t,status:"accepted"}:t))},v=async e=>{let t=(0,i.createClient)(),{error:s}=await t.from("cards").update({status:"cancelled"}).eq("id",e);s||c(n.filter(t=>t.id!==e))},y=async e=>{let t=n.find(t=>t.id===e);if(t?.status==="expired")return void alert("This pass has expired and cannot be used.");let s=(0,i.createClient)(),{error:a}=await s.from("cards").update({status:"used",used_at:new Date().toISOString()}).eq("id",e);a?(console.error("Failed to mark card as used:",a),alert("Failed to mark this pass as used. Please try again.")):(c(n.map(t=>t.id===e?{...t,status:"used"}:t)),alert("This pass has been marked as used. The sender will also see this status."))},j=t=>{e.push(`/card?id=${t}`)};return p?(0,t.jsx)("div",{className:"min-h-screen relative flex items-center",style:{background:"#FFFEEF"},children:(0,t.jsx)("div",{className:"relative z-10 container mx-auto px-0 w-full text-center",children:(0,t.jsx)("p",{className:"regular_paragraph",children:"Loading..."})})}):(0,t.jsxs)("div",{className:"min-h-screen relative",style:{background:"#FFFEEF"},children:[(0,t.jsx)(l.default,{}),(0,t.jsx)("div",{className:"relative z-10 container mx-auto px-0 w-full pt-48 md:pt-56",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-4",children:[(0,t.jsxs)("div",{className:"mb-12",children:[(0,t.jsx)("h1",{className:"jenny-title text-5xl md:text-6xl mb-4",style:{fontWeight:300,letterSpacing:"-0.025em",lineHeight:1},children:"Received"}),(0,t.jsx)("p",{className:"regular_paragraph text-sm",children:"Passes others have sent you"})]}),n.length>0&&(0,t.jsxs)("div",{className:"flex gap-2 mb-6 flex-wrap",children:[(0,t.jsxs)("button",{onClick:()=>g("all"),className:`px-4 py-2 text-sm border transition-colors ${"all"===h?"bg-[#f20e0e] text-white border-[#f20e0e]":"bg-white text-[#f20e0e] border-[#f20e0e] md:hover:bg-[#f5f5f5]"}`,children:["All (",n.length,")"]}),(0,t.jsxs)("button",{onClick:()=>g("pending"),className:`px-4 py-2 text-sm border transition-colors ${"pending"===h?"bg-[#f20e0e] text-white border-[#f20e0e]":"bg-white text-[#f20e0e] border-[#f20e0e] md:hover:bg-[#f5f5f5]"}`,children:["Pending (",n.filter(e=>"pending"===e.status||!e.status).length,")"]}),(0,t.jsxs)("button",{onClick:()=>g("accepted"),className:`px-4 py-2 text-sm border transition-colors ${"accepted"===h?"bg-[#f20e0e] text-white border-[#f20e0e]":"bg-white text-[#f20e0e] border-[#f20e0e] md:hover:bg-[#f5f5f5]"}`,children:["Accepted (",n.filter(e=>"accepted"===e.status).length,")"]}),(0,t.jsxs)("button",{onClick:()=>g("used"),className:`px-4 py-2 text-sm border transition-colors ${"used"===h?"bg-[#f20e0e] text-white border-[#f20e0e]":"bg-white text-[#f20e0e] border-[#f20e0e] md:hover:bg-[#f5f5f5]"}`,children:["Used (",n.filter(e=>"used"===e.status).length,")"]})]}),0===o.length?(0,t.jsx)("div",{className:"text-center py-20",children:(0,t.jsx)("p",{className:"regular_paragraph mb-6",children:0===n.length?"No received passes yet":`No ${h} passes`})}):(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:o.map(e=>(0,t.jsxs)("div",{className:"y2k-window p-6 md:hover:border-[#f20e0e] transition-all",children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("div",{className:"jenny-heading text-lg",style:{fontWeight:300,letterSpacing:"-0.025em"},children:["From ",e.sender_name||"Someone"]}),e.status&&(0,t.jsx)("span",{className:"regular_paragraph text-xs",style:{color:"used"===e.status?"#999999":"accepted"===e.status?"#f20e0e":"#666666",textTransform:"uppercase",fontSize:"10px",fontWeight:500},children:e.status})]}),(0,t.jsx)("div",{className:"jenny-label text-xs mb-1",children:(0,r.format)(new Date(e.created_at),"MMM dd, yyyy")}),e.message&&(0,t.jsx)("p",{className:"regular_paragraph text-xs line-clamp-2 mt-2",children:e.message})]}),(0,t.jsx)("div",{className:"flex gap-2",children:"pending"!==e.status&&e.status?"accepted"===e.status?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:()=>j(e.id),className:"flex-1 px-3 py-2 text-xs border border-[#e5e5e5] md:hover:bg-[#f5f5f5] active:bg-[#f5f5f5] transition-colors",children:"View"}),(0,t.jsx)("button",{onClick:()=>y(e.id),className:"flex-1 px-3 py-2 text-xs y2k-button",style:{padding:"8px 12px",fontSize:"12px"},children:"Use Now"})]}):(0,t.jsx)("button",{onClick:()=>j(e.id),className:"w-full px-3 py-2 text-xs border border-[#e5e5e5] hover:bg-[#f5f5f5] transition-colors",children:"View Details"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:()=>v(e.id),className:"flex-1 px-3 py-2 text-xs border border-[#e5e5e5] md:hover:bg-[#f5f5f5] active:bg-[#f5f5f5] transition-colors",children:"Decline"}),(0,t.jsx)("button",{onClick:()=>b(e.id),className:"flex-1 px-3 py-2 text-xs y2k-button",style:{padding:"8px 12px",fontSize:"12px"},children:"Accept"})]})})]},e.id))})]})}),(0,t.jsx)(d.default,{})]})}e.s(["default",()=>n])}]);